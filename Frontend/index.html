<!DOCTYPE html>
<html lang="en">
<head>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <link rel="stylesheet" type="text/css" href="Styles.css">
 
    <title>Boleta</title>
    
</head>
<header id="contenidoHeader">
    <h1>Ferremás</h1>

</header>
<body>
<h3>Boleta</h3>

<form>
        
    <label for="cboCliente">Info cliente:</label>
    <label> Rut cliente: </label>
    <select name="infoCliente" id="infoCliente"></select>
    <br>
    <label for="cboProducto">Tipo de producto:</label>
    <select name="cboProducto" id="cboProducto">
        <option value="1">Herramienta</option>
        <option value="2">Accesorio</option>
        <option value="3">Material</option>
    </select>
    <br>
    
<label for="cboSubProducto">Subproducto:</label>
<select name="cboSubProducto" id="cboSubProducto"></select>

<script>
    const cboProducto = document.getElementById('cboProducto');
    const cboSubProducto = document.getElementById('cboSubProducto');

    // Define las opciones de subproducto para cada tipo de producto
    const opcionesSubProducto = {
        1: ["Martillo", "Destornillador", "Sierra"],
        2: ["Gafas", "Cinturón", "Bolsa"],
        3: ["Madera", "Metal", "Plástico"]
    };

    // Función para actualizar las opciones del segundo select
    function actualizarSubProducto() {
        // Borra las opciones actuales del segundo select
        cboSubProducto.innerHTML = '';

        // Obtiene las opciones correspondientes al tipo de producto seleccionado
        const tipoProductoSeleccionado = cboProducto.value;
        const opciones = opcionesSubProducto[tipoProductoSeleccionado];

        // Agrega las nuevas opciones al segundo select
        opciones.forEach(opcion => {
            const option = document.createElement('option');
            option.text = opcion;
            option.value = opcion.toLowerCase(); // Puedes asignar un valor diferente si lo deseas
            cboSubProducto.add(option);
        });
    }

    // Llama a la función para actualizar las opciones del segundo select cuando cambia la selección del primer select
    cboProducto.addEventListener('change', actualizarSubProducto);

    // Llama a la función una vez al inicio para asegurarse de que las opciones estén actualizadas
    actualizarSubProducto();
</script>
    <br>
    <label for="txtCantidad">Cantidad:</label>
    <input type="number" name="txtCantidad" id="txtCantidad">
    <br>
    <button id="btnEnviar" class="btn btn-primary">Enviar</button>
</form>
<script type="text/javascript">
    // fetch == curl
    const cboCliente = document.getElementById('infoCliente');
    const listaClientes = fetch("http://localhost:5000/api/cliente", {
        headers: {
            "Content-Type": "application/json",
            "Access-Control-Allow-Origin": "*",
        },
        mode: 'cors'
    });
    listaClientes.then(async function(e){
        await e.json().then(async function(objeto){
            //console.log(objeto);
            let itemsStr = "";
            objeto.forEach(element => {
                console.log({element});
                itemsStr += "<option value='"+ element.id +"'>" + element.rut + "</option>";
            });
            infoCliente.innerHTML = itemsStr;
        });
    }).catch(function(error){
        alert(error.message);
    }).finally(() => {
        console.log("Termino el proceso del fetch a clientes");
    });

    function clickEnviar(e){
        e.preventDefault();
        const idCliente = document.getElementById("infoCliente").value;
        const idProducto = document.getElementById("cboProducto").value;
        const cantidad = document.getElementById("txtCantidad").value;
        
        const objEnvio = {
            "id_cliente": idCliente,
            "producto_id": idProducto,
            "cantidad": cantidad
        };
        console.log({objEnvio});
        
        // envio a factura - API FLASK
        fetch("http://localhost:5000/api/boleta", {
            headers: {
                "Content-Type": "application/json",
                "Access-Control-Allow-Origin": "*",
            },
            mode: 'cors',
            method: 'POST',
            body: JSON.stringify(objEnvio)
        }).then(async function(e){
            await e.json().then((obj) => { console.log({obj}) });
        }).catch(function(error){ alert(error.message) })
        .finally(function(){
            alert("Completado");
         
        });

    }

    const btnEnviar = document.getElementById('btnEnviar');
    btnEnviar.addEventListener("click", clickEnviar);

</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
</body>
</html> 